net.bufsize(1232)
modules.unload('priming')
modules.unload('ta_signal_query')

cache.size = 10*MB
cache.clear()

ffi = require('ffi')

-- local buffer = {}
local buffer_log_cb = ffi.cast('trace_log_f', function (msg)
	io.write(ffi.string(msg))
end)


local finish_cb = ffi.cast('trace_callback_f', function (req)
	log(req:selected_tostring())
end)

--verbose(true)
function t()
	resolve {
		name = 'c.577qr.com.',
		type = kres.type.A,
		options = {'TRACE'},
		init = function (req)
			req.trace_log = buffer_log_cb
			req.trace_finish = finish_cb
		end
	}
end

event.after(0, function()
	t()
end)
