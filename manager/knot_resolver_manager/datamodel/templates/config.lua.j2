{% from 'macros/common_macros.lua.j2' import quotes, modules_load %}

{% if not cfg.lua.script_only %}

-- FFI library
ffi = require('ffi')
local C = ffi.C

-- hostname
hostname({{ quotes(cfg.hostname) }})

{% if cfg.nsid %}
-- nsid
{{ modules_load('nsid') }}
nsid.name({{ quotes(cfg.nsid) }} .. worker.id)
{% endif %}

{% include "logging.lua.j2" %}

{% include "monitoring.lua.j2" %}

{% include "webmgmt.lua.j2" %}

{% include "options.lua.j2" %}

{% include "network.lua.j2" %}

{% include "views.lua.j2" %}

{% include "dnssec.lua.j2" %}

{% include "local_data.lua.j2" %}

{% include "forward.lua.j2" %}

{% include "cache.lua.j2" %}

{% include "dns64.lua.j2" %}

{% endif %}

{% if cfg.lua.script_file or cfg.lua.script%}
--------------------------------------------------------------------------------
-- LUA custom script
--------------------------------------------------------------------------------
-- Additional lua code that cannot be validated.

{% if cfg.lua.script_file %}
{% import cfg.lua.script_file as file_script %}
{{ file_script }}
{% elif cfg.lua.script %}
{{ cfg.lua.script }}
{% endif %}
{% endif %}